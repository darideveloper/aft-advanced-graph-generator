---
import BarChart from '../components/sections/BarChart.astro'
import '../styles/tailwind.css'

// Capturar par√°metros de la URL (survey_id y participant_id)
const url = new URL(Astro.request.url)
const raw_data = url.searchParams.get('data')

function decodeUnicodeEscapes(str: string) {
  // First, replace double backslashes with single backslashes
  // This converts \\u00f3 to \u00f3
  return str.replace(/\\\\u([0-9a-fA-F]{4})/g, '\\u$1');
}

const decodedParam = decodeUnicodeEscapes(raw_data ?? '{}');
const fullyDecodedData = JSON.parse(decodedParam);

console.log(fullyDecodedData);
---

<html lang='es'>
  <head>
    <meta charset='utf-8' />
    <meta
      name='viewport'
      content='width=device-width, initial-scale=1'
    />
    <title>AFT Advanced Graph Generator</title>
  </head>
  <body>
    <main>
      <BarChart
        data={fullyDecodedData}
      />
    </main>
  </body>
</html>
